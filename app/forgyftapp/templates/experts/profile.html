{% extends "base/base.html" %}

{% block extra_js_dependencies %}
	<script src="{% load static %}{% static "semantic/components/rating.min.js" %}"></script>
{% endblock %}

{% block extra_dependencies %}
	<link rel="stylesheet" type="text/css" href="{% load static %}{% static "semantic/components/rating.min.css" %}">
{% endblock %}

{% block content %}
	<div class="ui main container">
		<div class="ui two column doubling stackable grid">
		<div class="four wide column">
			<div class="ui container segment" style="width: 100%">
				<h1>{{ user.first_name }} {{ user.last_name }}</h1>
				<p>Joined {{ user.date_joined|date:"M d, Y" }}</p>
			</div>
			<div class="ui container" style="width: 100%">
				<div class="ui card">
					<div class="content">
						<div class="header">
							Average Gift Rating
						</div>
						<div class="meta">
							<span class="date">
								{{ user.rating_amount }} User Ratings
							</span>
						</div>
					</div>
					<div class="extra content">
						<div class="ui rating disabled" data-rating="{{ user.average_rating }}"
						     data-max-rating="5"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="twelve wide column">
			<div class="ui container segment" style="width: 100%;">
				{% if expert_profile_form %}
					<h1>Hey {{ user.first_name }}, let's finish setting up your expert account</h1>
					<div class="ui divider"></div>
					<div class="ui relaxed divided list">
						{% include "base/form_template.html" with form=expert_profile_form action_text="Submit" %}
					</div>
				{% elif sample_gift_request %}
					<h1>Last step, let's try filling out a sample gift request</h1>
					<div class="ui divider"></div>
					<p>When a use submits a gift request that matches your profile, you'll automatically get an
						email asking you to fill out the gift request. Gift requests will generally look like this,
						you should try to use as much information given to find the perfect gift ideas. Good luck!</p>
					<div style="padding-bottom: 8px"></div>
					<div class="ui relaxed divided list">
						{% include "base/giftee_profile.html" with giftee_profile=sample_gift_request no_close=True no_open=True %}
						{% include "base/form_template.html" with form=expert_profile_form action_text="Submit" %}
						<div class="ui divider"></div>
						<h1 style="text-align: center; padding-bottom: 4px">Enter Gift Ideas
							for {{ giftee_profile.name }} by {{ giftee_profile.user.first_name }}'s request</h1>
						<div>
							<form action="" method="post" id="ideaForm">{% csrf_token %}
								<table class="ui table" style="margin-top: 0">
									{{ gift_ideas.management_form }}
									<!-- After management form -->
									{% for form in gift_ideas.forms %}
									{% if forloop.first %}
										<thead>
										<tr>
											{% for field in form.visible_fields %}
												<th>{{ field.label|capfirst }}</th>
											{% endfor %}
										</tr>
										</thead>
								f	{% endif %}
									<tbody>
									<tr class="{% cycle row1 row2 %} formset_row">
										{% for field in form.visible_fields %}
										<td>
											{% if forloop.first %}
												{% if form.instance.pk %}{{ form.DELETE }}{% endif %}
												{% for hidden in form.hidden_fields %}
													{{ hidden }}
												{% endfor %}
											{% endif %}
											{% if field.errors %}
												<div class="ui list">
													{% for error in field.errors %}
														<div class="item">
															<div class="ui negative message">
																<p>
																	{{ error }}
																</p>
															</div>
														</div>
													{% endfor %}
												</div>
											{% endif %}
											{% if "textarea" in field.field.widget.template_name %}
											<div class="field">
												{% if field.help_text %}
												<label style="font-weight: 100; font-size: 13px; display: inline">
													-
													{% autoescape off %}
													{{ field.help_text }}
													{% endautoescape %}
												</label>
												{% endif %}
												<textarea rows="{{ field.field.widget.attrs.rows }}"
												          name="{{ field.html_name }}"
												          id="{{ field.id_for_label }}"
												          style="width: 100%">{% if field.value %}
													{{ field.value }}{% endif %}</textarea>
											</div>
											{% elif field.field.widget.input_type == "checkbox" and field.label != "Delete" %}
											<div class="inline field">
												<div class="ui toggle checkbox">
													<input {% if field.value == True %}checked{% endif %}
													       type="checkbox" tabindex="0" class="hidden toggle"
													       style="display: inline"
													       name="{{ field.html_name }}"
													       id="{{ field.id_for_label }}">
													{% if field.help_text %}
													<p style="font-weight: 100; display: inline"> -
														{% autoescape off %}
														{{ field.help_text }}{% endautoescape %}</p>
													{% endif %}
												</div>
											</div>
											{% else %}
											{% if field.label != "Delete" %}
											<div class="field">
												{% if field.help_text %}
												<label style="font-weight: 100; font-size: 13px; display: inline">
													{% autoescape off %}
													- {{ field.help_text }}
													{% endautoescape %}
												</label>
												{% endif %}
												<div class="ui input" style="width: 100%">{{ field }}</div>
											</div>
											{% endif %}
											{% endif %}
										</td>
										{% endfor %}
									</tr>
									</tbody>

									{% endfor %}
								</table>
								<div class="ui one column stackable center aligned page grid">
									<div class="column sixteen wide">
										<div class="ui fluid buttons">
											<input class="ui positive button" name="gift_ideas" type="submit"
											       value="Save"/>
											<div class="or"></div>
											<a class="ui negative button" href="{% url 'forgyftapp:fulfill' %}">Back</a>

										</div>
										<a class="ui button" href="{{ giftee_profile.admin_url }}"
										   style="margin-top: 8px">
											View on Admin Site
										</a>
									</div>
								</div>

							</form>
						</div>
					</div>
				{% endif %}
			</div>
		</div>
	</div>
	</div>

<script src="{% load static %}{% static "semantic/components/checkbox.min.js" %}"></script>
<script src="{% load static %}{% static "jquery.formset.js" %}"></script>
<script type="text/javascript">

	checked = {% if published %}true{% else %}false{% endif %};

	$(document).ready(function () {
		$(".hover-load").hover(function () {
			image = $(this).find(".hover-load-image");
			image.attr("src", image.data("src"));
			$(this).find(".ui.placeholder").remove();
		}, function () {
		});
		$('.formset_row').formset({
			{#$('#myForm tbody tr').formset({#}
			addText: 'Add an Idea',
			addCssClass: 'primary ui button add add-row',
			deleteText: 'Remove',
			deleteCssClass: 'ui fluid danger button delete-row',
			added: function (row) {
				setup();
			},
			prefix: '{{ gift_ideas.prefix }}'
		});
	});

	function setup() {
		{#alert("setup")#}
		checkboxes = $('.ui.toggle.checkbox');
		changing = false;
		checkboxes.checkbox("setting", "onChange", function () {
			if (changing) {
				return null;
			}
			if (!checked) {
				checkboxes.checkbox("check");
				checked = true
			} else {
				checkboxes.checkbox("uncheck");
				checked = false
			}
		});
		if (checked) {
			changing = true;
			checkboxes.checkbox("check");
			changing = false;
		} else {
			changing = true;
			checkboxes.checkbox("uncheck");
			changing = false;
		}
	}


</script>
{% endblock %}